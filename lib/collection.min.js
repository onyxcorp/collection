var lodash={objects:{assign:require("lodash-node/modern/objects/assign"),defaults:require("lodash-node/modern/objects/defaults"),has:require("lodash-node/modern/objects/has"),clone:require("lodash-node/modern/objects/clone"),isArray:require("lodash-node/modern/objects/isArray"),isString:require("lodash-node/modern/objects/isString"),isFunction:require("lodash-node/modern/objects/isFunction"),isObject:require("lodash-node/modern/objects/isObject"),pairs:require("lodash-node/modern/objects/pairs")},functions:require("lodash-node/modern/functions"),arrays:require("lodash-node/modern/arrays"),collections:require("lodash-node/modern/collections")},Model=require("model"),extend=require("backbone-extend-standalone"),Collection;Collection=function(e,t){t=t||{},t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,lodash.objects.assign({silent:!0},t))},lodash.objects.assign(Collection.prototype,{_sortOrder:"ASC",model:Model,initialize:function(){},toJSON:function(){return this.map(function(e){return e.toJSON()})},toObjectJSON:function(e){var t,o,s;return t=this.toJSON(),s=lodash.collections.pluck(t,e||this.model.prototype.idAttribute||"id"),o={},lodash.collections.forEach(s,function(e,s){if(Object.prototype.hasOwnProperty.call(o,e))if(o[e]instanceof Array)o[e].push(t[s]);else{var i=o[e];o[e]=[i,t[s]]}else o[e]=t[s]}),o},add:function(e,t){return this.set(e,lodash.objects.assign({merge:!1},t,{add:!0,remove:!1}))},set:function(e,t){var o,s,i,r,n,l,h,d,a,c,u,m,f,p;for(t=lodash.objects.defaults({},t,{add:!0,remove:!0,merge:!0}),o=!lodash.objects.isArray(e),e=o?e?[e]:[]:e.slice(),t.at<0&&(t.at+=this.length+1),h=this.comparator&&null==t.at&&t.sort!==!1,d=lodash.objects.isString(this.comparator)?this.comparator:null,a=[],c=[],u={},f=!1,p=0,length=e.length;p<length;p++){if(r=e[p],n=this.get(r))t.remove&&(u[n.cid]=!0),t.merge&&r!==n&&(r=this._isModel(r)?r.attributes:r,n.set(r,t),h&&!l&&n.hasChanged(d)&&(l=!0)),e[p]=n;else if(t.add){if(i=e[p]=this._prepareModel(r,t),!i)continue;a.push(i),this._addReference(i,t)}i=n||i,i&&(s=this.modelId(i.attributes),m=!h&&t.add&&t.remove?[]:!1,!m||!i.isNew()&&u[s]||(m.push(i),f=f||!this.models[p]||i.cid!==this.models[p].cid),u[s]=!0)}if(t.remove){for(p=0,length=this.length;p<length;p++)u[(i=this.models[p]).cid]||c.push(i);c.length&&this.remove(c,t)}if(a.length||f)if(h&&(l=!0),this.length+=a.length,null!==t.at)for(p=0,length=a.length;p<length;p++)this.models.splice(t.at+p,0,a[p]);else{m&&(this.models.length=0);var g=m||a;for(p=0,length=g.length;p<length;p++)this.models.push(g[p])}return l&&this.sort(),o?e[0]:e},remove:function(e,t){var o,s,i,r,n;for(o=!lodash.objects.isArray(e),e=o?[e]:lodash.objects.clone(e),t=t||{},n=0,length=e.length;n<length;n++)s=e[n]=this.get(e[n]),s&&(r=this.modelId(s.attributes),null!==r&&delete this._byId[r],delete this._byId[s.cid],i=this.indexOf(s),this.models.splice(i,1),this.length--,this._removeReference(s,t));return o?e[0]:e},reset:function(e,t){t=t?lodash.objects.clone(t):{};for(var o=0,s=this.models.length;s>o;o++)this._removeReference(this.models[o],t);return t.previousModels=this.models,this._reset(),e=this.add(e,lodash.objects.assign({silent:!0},t))},get:function(e){var t;return null==e?void 0:(t=this.modelId(this._isModel(e)?e.attributes:e),this._byId[e]||this._byId[t]||this._byId[e.cid])},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e){return e[this.model.prototype.idAttribute||"id"]},modelUpdate:function(e){var t,o;t=this.modelId(e.previousAttributes()),o=this.modelId(e.attributes),t!==o&&(null!=t&&delete this._byId[t],null!=o&&(this._byId[o]=e))},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;return t=t?lodash.objects.clone(t):{},t.collection=this,new this.model(e,t)},_addReference:function(e){var t;this._byId[e.cid]=e,t=this.modelId(e.attributes),null!=t&&(this._byId[t]=e)},_removeReference:function(e){this===e.collection&&delete e.collection},_isModel:function(e){return e instanceof Model},push:function(e,t){return this.add(e,lodash.objects.assign({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,lodash.objects.assign({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return[].slice.apply(this.models,arguments)},at:function(e){return 0>e&&(e+=this.length),this.models[e]},findWhere:function(e){return this.where(e,!0)},where:function(e,t){var o,s;return o=function(e){var t=lodash.objects.pairs(e),o=t.length;return function(e){if(null==e)return!o;e=new Object(e);for(var s=0;o>s;s++){var i=t[s],r=i[0];if(i[1]!==e[r]||!(r in e))return!1}return!0}},s=o(e),lodash.collections[t?"find":"filter"](this.models,function(e){return s(e.attributes)})},setSortingOrder:function(e){if("ASC"!==e&&"DESC"!==e)throw new Error("Sorting order only accepts values ASC or DESC");this._sortOrder=e},sort:function(){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return lodash.objects.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(lodash.functions.bind(this.comparator,this)),"DESC"===this._sortOrder&&this.models.reverse(),this},pluck:function(e){return lodash.collections.invoke(this.models,"get",e)}});var methods=["forEach","map","reduce","reduceRight","reject","every","some","contains","invoke","max","min","toArray","size","first","last","shuffle","without","difference","initial","rest","indexOf"];lodash.collections.forEach(methods,function(e){var t;(lodash.collections[e]||lodash.arrays[e])&&(Collection.prototype[e]=function(){var o=[].slice.call(arguments);return o.unshift(this.models),t=lodash.collections[e]?"collections":"arrays",lodash[t][e].apply(lodash[t],o)})});var attributeMethods=["groupBy","countBy","sortBy","indexBy"];lodash.collections.forEach(attributeMethods,function(e){lodash.collections[e]&&(Collection.prototype[e]=function(t,o){var s=lodash.objects.isFunction(t)?t:function(e){return e.get(t)};return lodash.collections[e](this.models,s,o)})}),Collection.extend=extend,module.exports=Collection;
